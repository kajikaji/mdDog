[% INCLUDE header.tmpl %]
[% INCLUDE apptitle.tmpl %]
[% INCLUDE userinfo.tmpl %]
<div>[% debug %]</div>

<section class="Top">

<div class="Main">
  <div class="Subject">
    <span class="Title">registed documents</span>
  [% IF login %]
    <div class="Menu">
      <a href="doc_create.cgi" class="Button"><span class="typcn typcn-document-add"></span>new document</a>
    </div>
  [% END %]
  </div>

  [%IF infos %]
    [%IF login %]
    <ul class="DocFilter">
      <li>[%UNLESS style %]一覧[%ELSE %]<a href="?style=">一覧</a>[%END %]</li>
      <li>[%IF style == 'approver' %]承認権限[%ELSE %]<a href="?style=approver">承認権限</a>[%END %]</li>
      <li>[%IF style == 'dustbox' %]ゴミ箱[%ELSE %]<a href="?style=dustbox">ゴミ箱</a>[%END %]</li>
    </ul>
    [%END %]

  <table class="DocList">
    <tbody>
      [% FOREACH info IN infos %]
      <tr class="[% IF info.is_used %]Active[% ELSE %]Nonactive[% END %] [% IF info.deleted_at %]Deleted[% END %]">
        <td class="Info">

          [% UNLESS info.deleted_at %]
          <ul class="DocCtrl">
            [%IF info.is_used %]
              <li><a href="doc_history.cgi?fid=[% info.id %]" class="PopupHelper" data-info="履歴"><span class="typcn typcn-book"></span></a></li>
              <li><a href="doc_outline.cgi?fid=[% info.id %]" class="PopupHelper" data-info="プレビュー"><span class="typcn typcn-printer"></span></a></li>

              [%IF info.is_editable || is_admin %]
                <li><a href="edit_buffer.cgi?fid=[% info.id %]" class="PopupHelper" data-info="編集"><span class="typcn typcn-edit"></span></a></li>
              [%ELSE %]
                <li><span class="PopupHelper" data-info="編集(権限がありません)"><span class="typcn typcn-edit"></span></span></li>
              [%END %]

              [%IF info.is_approve || is_admin %]
                <li><a href="doc_approve.cgi?fid=[% info.id %]" class="PopupHelper" data-info="承認"><span class="typcn typcn-input-checked"></span></a></li>
              [%ELSE %]
                <li><span class="PopupHelper" data-info="承認(権限がありません)"><span class="typcn typcn-input-checked"></span></span></li>
              [%END %]

              [%IF info.is_owned || is_admin %]
                <li><a href="doc_setting.cgi?fid=[% info.id %]" class="PopupHelper" data-info="設定"><span class="typcn typcn-cog-outline"></span></a></li>
              [%ELSE %]
                <li><span class="PopupHelper" data-info="設定(権限がありません）"><span class="typcn typcn-cog-outline"></span></span></li>
              [%END %]
            [%END %]
            <li><form action="" method="post" class="Warn">
            [%IF info.is_used %]
              [%IF info.is_owned || is_admin || is_delete %]
                <button type="submit" name="unuse" value="1" class="PopupHelper" data-info="削除"><span class="typcn typcn-trash"></span></button>
              [%ELSE %]
                <span  class="PopupHelper" data-info="削除(権限がありません)"><span class="typcn typcn-trash"></span></span>
              [%END %]
            [% ELSE %]
              [%IF info.is_owned || is_admin || is_delete %]
                <button type="submit" name="use" value="1" class="PopupHelper" data-info="復旧"><span class="typcn typcn-power-outline"></span></button>
                <button type="submit" name="delete" value="1" class="PopupHelper" data-info="完全に削除"><span class="typcn typcn-times"></span></button>
              [%ELSE %]
                <span  class="PopupHelper" data-info="復旧(権限がありません)"><span class="typcn typcn-power-outline"></span></span>
                <span class="PopupHelper" data-info="完全に削除(権限がありません)"><span class="typcn typcn-times"></span></span>
              [%END %]
            [% END %]
              <input type="hidden" name="style" value="[% style %]">
              <input type="hidden" name="page" value="[% page %]">
              <input type="hidden" name="fid" value="[% info.id %]">
            </form></li>
          </ul>
          [% END %] <!-- UNLESS info.deleted_at -->
          
          <div class="DocSubject">
	        <div class="Name">
              [% IF info.deleted_at %]
                [% info.doc_name %]
              [% ELSIF info.is_used %]
                <a href="doc_history.cgi?fid=[% info.id %]">[% info.doc_name %]</a>
              [% ELSE %]
                [% info.doc_name %]
              [% END %]
	        </div>
            [%IF info.is_used && (info.is_public || info.is_approve || info.is_editable) %]
              <ul class="Tags">
                [%IF info.is_public %]<li class="Public"><div>public</div></li>[%END %]
              </ul>
           [%END %]
          </div> <!-- doc-subject -->

          <div class="DocDetail">
          [%IF !info.deleted_at and info.is_used %]
            <div class="">[<a href="download.cgi?fid=[% info.id %]">最新版DL</a>]</div>
          [%END %]
            <div class="CreateAt">作成日時:[% info.created_at %]</div>
            <div class="CreatedBy">管理者:[% info.created_by %]</div>
            <div class="LastApprovedAt">最終承認日時:[% info.last_updated_at %]</div>
            <div class="Filesize">ファイルサイズ:[% info.file_size %]byte</div>
          </div>
        </td>
      </tr>
      [% END %]
    </tbody>
  </table>
  <ul class="Paging">
    [%FOREACH p IN paging %]
      <li>[%IF p == page %]<span class="Selected">[% p + 1 %]</span>[%ELSE %]<a href="?style=[% style %]&page=[% p %]">[% p + 1%]</a>[%END %]</li>
    [%END %]
  </ul>
  <div class="DocumentCount">[% document_count %]件</div>
  [% ELSE %]
  <div class="NoFile">
    ファイルは登録されていません
  </div>
  [% END %]
</div><!-- top-menu -->

</section>

[%INCLUDE footer.tmpl %]


