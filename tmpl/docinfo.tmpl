[% INCLUDE header.tmpl %]
[% INCLUDE apptitle.tmpl %]
[% INCLUDE userinfo.tmpl %]

<ul class="back-nav">
<li><a href="index.cgi">ファイル一覧に戻る</a></li>
</ul>

<section class="docinfo">
<h1>ドキュメントの詳細</h1>
<h2><a href="download.cgi?fid=[% fid %]" class="glyph download-alt"></a> [% file_name %]</h2>
<div class="description">
  <div class="created-at">作成日時：</div>
  <div class="created-by">作成者：</div>
  <div class="last-approved-at">最終承認日時：</div>
  <div class="filesize">ファイルサイズ：</div>
</div>

[% IF login %]
<div class="user-action">
<ul class="menu">
<li><a href="md_edit.cgi?fid=[% fid %]" class="btn">編集</a></li>
<li>
  <form action="?fid=[% fid %]" method="post" id="docx-upload" class="doc-upload-form" enctype="multipart/form-data">
    <div class="upload">ファイルアップロード</div>
    <div><label></label><input type="file" name="docxfile" /></div>
    <div><label>詳細：</label><input type="text" size="50" name="detail"></div>
    <div>
      <input type="submit" name="upload" value="アップロード">
      <input type="hidden" name="fid" value="[% fid %]">
    </div>
  </form>
</li>
</ul>
</div>
[% END %]
</section><!-- docinfo -->

<section class="gitlog master">
<h3 class="subject">編集履歴</h3>
<table class="gitlog">
<thead>
  <tr>
    <th class="date">更新年月日</th>
    <th class="message">詳細</th>
    <th class="author">更新者</th>
    <th class="ctrl">操作</th>
  </tr>
</thead>
<tbody>
[% FOREACH log IN sharedlist %]
  <tr class="master">
    <td class="date">[% log.attr.date %]</td>
    <td class="message">[% log.message %]</td>
    <td class="author">[% log.attr.author %]</td>
    <td class="ctrl">

        <span class="download-link"><a href="download.cgi?fid=[% fid %]&revision=[% log.id %]">download</a></span>
        [% UNLESS loop.last %]
          <br><span class="diff"><a href="docdiff.cgi?fid=[% fid %]&revision=[% log.id %]">差分</a></spa>
        [% END %]
    </td>
  </tr>
[% END %]
</tbody>
</table>
</section><!-- gitlog.master -->


[%FOREACH user IN userlist %]
<section class="gitlog user">
<div class="subject">[% user.name %]さんの編集履歴</div>
[% UNLESS user.is_live %]<div class="description alert">編集状態が古くなっています。次にコミットした際に古い編集履歴は削除されます</div>[% END %]
[% IF user.loglist.size == 0 %]
<div class="gitlog description">編集履歴はありません</div>
[% ELSE %]
<table class="gitlog user-branch">
<thead>
  <tr>
    <th class="date">更新年月日</th>
    <th class="message">詳細</th>
    <th class="author">更新者</th>
    <th class="ctrl">操作</th>
  </tr>
</thead>
<tbody>
[% FOREACH log IN user.loglist %]
  <tr class="user-branch [% UNLESS user.is_live %]old[% END %]">
    <td class="date">[% log.attr.date %]</td>
    <td class="message">[% log.message %]</td>
    <td class="author">[% log.attr.author %]</td>
    <td class="ctrl">
[% IF is_mdfile %]
<span class="mdfile-toolbar"><a href="md_view.cgi?fid=[% fid %]">閲覧</a></span>
[% END %]

        <span class="download-link"><a href="download.cgi?fid=[% fid %]&revision=[% log.id %]">download</a></span>
        [% UNLESS loop.last %]
          <br><span class="diff"><a href="docdiff.cgi?fid=[% fid %]&revision=[% log.id %]">差分</a></spa>
        [% END %]
        <br><span class="master-diff"><a href="docdiff.cgi?fid=[% fid %]&revision=[% log.id %]&dist=master">共有との差分</a></spa>
        [% IF is_approve && user.is_live %]
            <br><span class="commit-approve"><a href="approve.cgi?fid=[% fid %]&user=[% user.uid %]&revision=[% log.id %]">ここまでを承認する</a></span>
        [% END %]
    </td>
  </tr>
[% END %]
</tbody>
</table>
[% END %]<!-- if user.loglist -->
</section><!-- gitlog.user -->
[% END %]<!-- foreach userlist -->

</body>
</html>
